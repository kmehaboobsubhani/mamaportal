import { Directive, ElementRef, HostBinding, Input, Renderer2, } from '@angular/core';
import { OutClickService } from '../shared';
import { DropdownService } from './dropdown.service';
import { DropdownState } from './dropdown.state';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../shared';
import * as ɵngcc2 from './dropdown.service';
import * as ɵngcc3 from './dropdown.state';
export class DropdownDirective {
    constructor(renderer, hostElement, outClickService, dropdownService, dropdownState) {
        this.renderer = renderer;
        this.hostElement = hostElement;
        this.outClickService = outClickService;
        this.dropdownService = dropdownService;
        this.dropdownState = dropdownState;
        this.direction = 'down';
        this.cDropdownAlign = '';
    }
    ngOnInit() {
        const state = { show: this.cDropdownShow, align: this.cDropdownAlign, direction: this.direction };
        this.state = this.dropdownState.setState(state);
        const dropdownClass = `drop${this.direction || 'down'}`;
        this.renderer.addClass(this.hostElement.nativeElement, dropdownClass);
        this.stateToggleSubscribe();
        this.outClickSubscribe();
    }
    ngOnDestroy() {
        this.stateToggleSubscribe(false);
        this.outClickSubscribe(false);
    }
    ngOnChanges(changes) {
        if (changes.direction) {
            this.renderer.removeClass(this.hostElement.nativeElement, `drop${changes.direction.previousValue || 'down'}`);
            this.renderer.addClass(this.hostElement.nativeElement, `drop${changes.direction.currentValue || 'down'}`);
        }
        if (changes.cDropdownShow) {
            const state = { show: changes.cDropdownShow.currentValue };
            this.state = this.dropdownState.setState(state);
            this.dropdownService.toggle(this.state);
        }
    }
    ngAfterViewInit() {
        this.cDropdownShow = this.state.show;
        this.dropdownService.toggle(this.state);
    }
    stateToggleSubscribe(subscribe = true) {
        if (subscribe) {
            this.stateToggleSubscription = this.dropdownService.dropdownState$.subscribe((state) => {
                if ('show' in state) {
                    this.show(state.show);
                }
            });
        }
        else {
            this.stateToggleSubscription.unsubscribe();
        }
    }
    show(show) {
        this.cDropdownShow = show;
        this.state = this.dropdownState.setState({ show });
        show ?
            this.renderer.addClass(this.hostElement.nativeElement, 'show') :
            this.renderer.removeClass(this.hostElement.nativeElement, 'show');
    }
    toggle() {
        this.show(!this.state.show);
    }
    outClickSubscribe(subscribe = true) {
        if (subscribe) {
            this.outClickSubscription = this.outClickService.outClick$.subscribe(message => {
                if (message.event) {
                    this.autoClose(message.event);
                }
            });
        }
        else {
            this.outClickSubscription.unsubscribe();
        }
    }
    autoClose(e) {
        const state = this.dropdownState.getState();
        if (state.show) {
            if (!this.hostElement.nativeElement.contains(e.target.closest('[cDropdownToggle]'))) {
                this.cDropdownShow = false;
                this.dropdownService.toggle({ show: false });
            }
        }
    }
}
DropdownDirective.ɵfac = function DropdownDirective_Factory(t) { return new (t || DropdownDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.OutClickService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DropdownService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.DropdownState)); };
DropdownDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DropdownDirective, selectors: [["", "cDropdown", ""], ["c-dropdown"]], hostVars: 1, hostBindings: function DropdownDirective_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("aria-expanded", ctx.cDropdownShow);
    } }, inputs: { direction: ["cDropdown", "direction"], cDropdownAlign: "cDropdownAlign", cDropdownShow: "cDropdownShow" }, exportAs: ["cDropdown"], features: [ɵngcc0.ɵɵProvidersFeature([DropdownService, DropdownState]), ɵngcc0.ɵɵNgOnChangesFeature] });
DropdownDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: OutClickService },
    { type: DropdownService },
    { type: DropdownState }
];
DropdownDirective.propDecorators = {
    direction: [{ type: Input, args: ['cDropdown',] }],
    cDropdownAlign: [{ type: Input }],
    cDropdownShow: [{ type: Input }, { type: HostBinding, args: ['attr.aria-expanded',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DropdownDirective, [{
        type: Directive,
        args: [{
                selector: '[cDropdown], c-dropdown',
                exportAs: 'cDropdown',
                providers: [DropdownService, DropdownState]
            }]
    }], function () { return [{ type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ElementRef }, { type: ɵngcc1.OutClickService }, { type: ɵngcc2.DropdownService }, { type: ɵngcc3.DropdownState }]; }, { direction: [{
            type: Input,
            args: ['cDropdown']
        }], cDropdownAlign: [{
            type: Input
        }], cDropdownShow: [{
            type: Input
        }, {
            type: HostBinding,
            args: ['attr.aria-expanded']
        }] }); })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jb3JldWktYW5ndWxhci9zcmMvbGliL2Ryb3Bkb3duL2Ryb3Bkb3duLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsU0FBUyxFQUNULFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUlMLFNBQVMsR0FFVixNQUFNLGVBQWUsQ0FBQztBQUd2QixPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQzFDLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUNuRCxPQUFPLEVBQUMsYUFBYSxFQUF5QixNQUFNLGtCQUFrQixDQUFDOzs7OztBQU92RSxNQUFNLE9BQU8saUJBQWlCO0FBQUksSUFxQmhDLFlBQ1UsUUFBbUIsRUFDbkIsV0FBdUIsRUFDdkIsZUFBZ0MsRUFDaEMsZUFBZ0MsRUFDaEMsYUFBNEI7QUFDcEMsUUFMUSxhQUFRLEdBQVIsUUFBUSxDQUFXO0FBQy9CLFFBQVksZ0JBQVcsR0FBWCxXQUFXLENBQVk7QUFDbkMsUUFBWSxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFDNUMsUUFBWSxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFDNUMsUUFBWSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtBQUN2QyxRQXpCcUIsY0FBUyxHQUFxQyxNQUFNLENBQUM7QUFDMUUsUUFBVSxtQkFBYyxHQUFpQixFQUFFLENBQUM7QUFDNUMsSUF1QkssQ0FBQztBQUVQLElBQUUsUUFBUTtBQUNULFFBQUcsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0FBQ3JHLFFBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFD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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBbkhBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFiQSxBQUFBLEFBTkEsQUFBQSxBQVdBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQVNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQWVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG4gIFNpbXBsZUNoYW5nZXMsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQge091dENsaWNrU2VydmljZX0gZnJvbSAnLi4vc2hhcmVkJztcbmltcG9ydCB7RHJvcGRvd25TZXJ2aWNlfSBmcm9tICcuL2Ryb3Bkb3duLnNlcnZpY2UnO1xuaW1wb3J0IHtEcm9wZG93blN0YXRlLCBEcm9wZG93blN0YXRlSW50ZXJmYWNlfSBmcm9tICcuL2Ryb3Bkb3duLnN0YXRlJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2NEcm9wZG93bl0sIGMtZHJvcGRvd24nLFxuICBleHBvcnRBczogJ2NEcm9wZG93bicsXG4gIHByb3ZpZGVyczogWyBEcm9wZG93blNlcnZpY2UsIERyb3Bkb3duU3RhdGUgXSxcbn0pXG5leHBvcnQgY2xhc3MgRHJvcGRvd25EaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcblxuICBASW5wdXQoJ2NEcm9wZG93bicpIGRpcmVjdGlvbjogJ2Rvd24nIHwgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd1cCcgPSAnZG93bic7XG4gIEBJbnB1dCgpIGNEcm9wZG93bkFsaWduOiAnJyB8ICdyaWdodCcgPSAnJztcbiAgLy8gQElucHV0KCkgY0Ryb3Bkb3duU2hvdyA9IGZhbHNlO1xuICAvLyBzZXQgY0Ryb3Bkb3duU2hvdyhjRHJvcGRvd25TaG93KSB7XG4gIC8vICAgdGhpcy5zdGF0ZSA9IHRoaXMuZHJvcGRvd25TdGF0ZS5zZXRTdGF0ZSh7c2hvdzogY0Ryb3Bkb3duU2hvd30pO1xuICAvLyAgIHRoaXMuc2hvdyhjRHJvcGRvd25TaG93KTtcbiAgLy8gfVxuICAvLyBnZXQgY0Ryb3Bkb3duU2hvdygpOiBib29sZWFuIHtcbiAgLy8gICB0aGlzLnN0YXRlID0gdGhpcy5kcm9wZG93blN0YXRlLmdldFN0YXRlKCk7XG4gIC8vICAgcmV0dXJuIHRoaXMuc3RhdGUuc2hvdztcbiAgLy8gfVxuXG4gIHByaXZhdGUgc3RhdGVUb2dnbGVTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBvdXRDbGlja1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIHN0YXRlOiBEcm9wZG93blN0YXRlSW50ZXJmYWNlO1xuXG4gIEBJbnB1dCgpXG4gIEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWV4cGFuZGVkJykgY0Ryb3Bkb3duU2hvdzogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBob3N0RWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG91dENsaWNrU2VydmljZTogT3V0Q2xpY2tTZXJ2aWNlLFxuICAgIHByaXZhdGUgZHJvcGRvd25TZXJ2aWNlOiBEcm9wZG93blNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkcm9wZG93blN0YXRlOiBEcm9wZG93blN0YXRlXG4gICkgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgY29uc3Qgc3RhdGUgPSB7IHNob3c6IHRoaXMuY0Ryb3Bkb3duU2hvdywgYWxpZ246IHRoaXMuY0Ryb3Bkb3duQWxpZ24sIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24gfTtcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5kcm9wZG93blN0YXRlLnNldFN0YXRlKHN0YXRlKTtcbiAgICAvLyBjb25zb2xlLmxvZygnY0Ryb3Bkb3duIE9uSW5pdCcsIHRoaXMuc3RhdGUsIHRoaXMuZHJvcGRvd25TdGF0ZS5nZXRTdGF0ZSgpKTtcbiAgICBjb25zdCBkcm9wZG93bkNsYXNzID0gYGRyb3Ake3RoaXMuZGlyZWN0aW9uIHx8ICdkb3duJ31gO1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LCBkcm9wZG93bkNsYXNzKTtcbiAgICB0aGlzLnN0YXRlVG9nZ2xlU3Vic2NyaWJlKCk7XG4gICAgdGhpcy5vdXRDbGlja1N1YnNjcmliZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZVRvZ2dsZVN1YnNjcmliZShmYWxzZSk7XG4gICAgdGhpcy5vdXRDbGlja1N1YnNjcmliZShmYWxzZSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMuZGlyZWN0aW9uKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgYGRyb3Ake2NoYW5nZXMuZGlyZWN0aW9uLnByZXZpb3VzVmFsdWUgfHwgJ2Rvd24nfWApO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQsIGBkcm9wJHtjaGFuZ2VzLmRpcmVjdGlvbi5jdXJyZW50VmFsdWUgfHwgJ2Rvd24nfWApO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlcy5jRHJvcGRvd25TaG93KSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHsgc2hvdzogY2hhbmdlcy5jRHJvcGRvd25TaG93LmN1cnJlbnRWYWx1ZSB9O1xuICAgICAgdGhpcy5zdGF0ZSA9IHRoaXMuZHJvcGRvd25TdGF0ZS5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgICB0aGlzLmRyb3Bkb3duU2VydmljZS50b2dnbGUodGhpcy5zdGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIC8vIGNvbnNvbGUubG9nKCdjRHJvcGRvd24gbmdBZnRlclZpZXdJbml0JywgdGhpcy5zdGF0ZSk7XG4gICAgdGhpcy5jRHJvcGRvd25TaG93ID0gdGhpcy5zdGF0ZS5zaG93O1xuICAgIHRoaXMuZHJvcGRvd25TZXJ2aWNlLnRvZ2dsZSh0aGlzLnN0YXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGVUb2dnbGVTdWJzY3JpYmUoc3Vic2NyaWJlOiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGlmIChzdWJzY3JpYmUpIHtcbiAgICAgIHRoaXMuc3RhdGVUb2dnbGVTdWJzY3JpcHRpb24gPSB0aGlzLmRyb3Bkb3duU2VydmljZS5kcm9wZG93blN0YXRlJC5zdWJzY3JpYmUoKHN0YXRlKSA9PiB7XG4gICAgICAgIGlmICgnc2hvdycgaW4gc3RhdGUpIHtcbiAgICAgICAgICB0aGlzLnNob3coc3RhdGUuc2hvdyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0YXRlVG9nZ2xlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgc2hvdyhzaG93KSB7XG4gICAgdGhpcy5jRHJvcGRvd25TaG93ID0gc2hvdztcbiAgICB0aGlzLnN0YXRlID0gdGhpcy5kcm9wZG93blN0YXRlLnNldFN0YXRlKHtzaG93fSk7XG4gICAgc2hvdyA/XG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCAsICdzaG93JykgOlxuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQgLCAnc2hvdycpO1xuICB9XG5cbiAgdG9nZ2xlKCkge1xuICAgIHRoaXMuc2hvdyghdGhpcy5zdGF0ZS5zaG93KTtcbiAgfVxuXG4gIHByaXZhdGUgb3V0Q2xpY2tTdWJzY3JpYmUoc3Vic2NyaWJlOiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGlmIChzdWJzY3JpYmUpIHtcbiAgICAgIHRoaXMub3V0Q2xpY2tTdWJzY3JpcHRpb24gPSB0aGlzLm91dENsaWNrU2VydmljZS5vdXRDbGljayQuc3Vic2NyaWJlKG1lc3NhZ2UgPT4ge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnY091dENsaWNrJywgbWVzc2FnZSlcbiAgICAgICAgaWYgKG1lc3NhZ2UuZXZlbnQpIHtcbiAgICAgICAgICB0aGlzLmF1dG9DbG9zZShtZXNzYWdlLmV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3V0Q2xpY2tTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBhdXRvQ2xvc2UoZSkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdhdXRvQ2xvc2UnLCBlKTtcbiAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZHJvcGRvd25TdGF0ZS5nZXRTdGF0ZSgpO1xuICAgIGlmIChzdGF0ZS5zaG93KSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnY29udGFpbnMnLCB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpLCBlLnRhcmdldCApO1xuICAgICAgLy8gaWYgKCFlLnRhcmdldC5jbG9zZXN0KCdbY0Ryb3Bkb3duVG9nZ2xlXScpKSB7XG4gICAgICBpZiAoIXRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5jb250YWlucyhlLnRhcmdldC5jbG9zZXN0KCdbY0Ryb3Bkb3duVG9nZ2xlXScpKSApIHtcbiAgICAgICAgdGhpcy5jRHJvcGRvd25TaG93ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZHJvcGRvd25TZXJ2aWNlLnRvZ2dsZSh7c2hvdzogZmFsc2V9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==
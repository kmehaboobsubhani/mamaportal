import { Directive, ElementRef, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { AnimationBuilder, useAnimation } from '@angular/animations';
import classNames from 'classnames';
import { collapseAnimation, expandAnimation } from './collapse.animations';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/animations';
export class CollapseDirective {
    constructor(hostElement, animationBuilder) {
        this.hostElement = hostElement;
        this.animationBuilder = animationBuilder;
        this.duration = '400ms';
        this.transition = 'ease-in-out';
        this.animate = true;
        this.collapseChange = new EventEmitter();
        this._show = false;
        this._animate = this.animate;
        this.host = this.hostElement.nativeElement;
    }
    get getClasses() {
        return this.hostClasses;
    }
    get hostClasses() {
        const classes = classNames({
            'navbar-collapse': !!this.navbar,
            show: !!this.show,
        });
        return classes;
    }
    ngOnInit() {
        this._show = this.show;
    }
    ngOnDestroy() {
        this.destroyPlayer();
    }
    ngOnChanges(changes) {
        if (changes.show) {
            (!changes.show.firstChange || !changes.show.currentValue) && this.toggle(changes.show.currentValue);
        }
    }
    ngDoCheck() {
        if (this._show !== this.show) {
            this.toggle();
        }
    }
    toggle(show = this.show) {
        this._show = show;
        this.createPlayer(show);
        this.player.play();
    }
    destroyPlayer() {
        if (this.player) {
            this.player.destroy();
        }
    }
    createPlayer(show = this.show) {
        if (this.player) {
            this.destroyPlayer();
        }
        let animationFactory;
        const duration = this._animate ? this.duration : '0ms';
        animationFactory = this.animationBuilder.build(useAnimation(show ? expandAnimation : collapseAnimation, { params: { time: duration, easing: this.transition } }));
        this.player = animationFactory.create(this.host);
        this.player.onStart(() => { this.collapseChange.emit(show ? 'opening' : 'collapsing'); });
        this.player.onDone(() => { this.collapseChange.emit(show ? 'open' : 'collapsed'); });
    }
}
CollapseDirective.ɵfac = function CollapseDirective_Factory(t) { return new (t || CollapseDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AnimationBuilder)); };
CollapseDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: CollapseDirective, selectors: [["", "cCollapse", ""]], hostVars: 2, hostBindings: function CollapseDirective_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassMap(ctx.getClasses);
    } }, inputs: { duration: "duration", transition: "transition", animate: "animate", navbar: "navbar", show: "show" }, outputs: { collapseChange: "collapseChange" }, exportAs: ["cCollapse"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
CollapseDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: AnimationBuilder }
];
CollapseDirective.propDecorators = {
    navbar: [{ type: Input }],
    duration: [{ type: Input }],
    transition: [{ type: Input }],
    show: [{ type: Input }],
    animate: [{ type: Input }],
    collapseChange: [{ type: Output }],
    getClasses: [{ type: HostBinding, args: ['class',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollapseDirective, [{
        type: Directive,
        args: [{
                selector: '[cCollapse]',
                exportAs: 'cCollapse'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.AnimationBuilder }]; }, { duration: [{
            type: Input
        }], transition: [{
            type: Input
        }], animate: [{
            type: Input
        }], collapseChange: [{
            type: Output
        }], getClasses: [{
            type: HostBinding,
            args: ['class']
        }], navbar: [{
            type: Input
        }], show: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFwc2UuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jb3JldWktYW5ndWxhci9zcmMvbGliL2NvbGxhcHNlL2NvbGxhcHNlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFXLFVBQVUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBZ0MsTUFBTSxFQUN2RyxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsZ0JBQWdCLEVBQW1CLFlBQVksRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3BGLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUVwQyxPQUFPLEVBQUMsaUJBQWlCLEVBQUUsZUFBZSxFQUFDLE1BQU0sdUJBQXVCLENBQUM7OztBQU16RSxNQUFNLE9BQU8saUJBQWlCO0FBQUksSUE2QmhDLFlBQ1UsV0FBdUIsRUFDdkIsZ0JBQWtDO0FBQzNDLFFBRlMsZ0JBQVcsR0FBWCxXQUFXLENBQVk7QUFBRSxRQUN6QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0FBQzlDLFFBN0JXLGFBQVEsR0FBRyxPQUFPLENBQUM7QUFDOUIsUUFBVyxlQUFVLEdBQUcsYUFBYSxDQUFDO0FBQ3RDLFFBQ1csWUFBTyxHQUFHLElBQUksQ0FBQztBQUMxQixRQUNZLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztBQUN4RCxRQUNVLFVBQUssR0FBRyxLQUFLLENBQUM7QUFDeEIsUUFBRSxhQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUMxQixRQXFCSSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDO0FBQy9DLElBQUUsQ0FBQztBQUNILElBbkJFLElBQ0ksVUFBVTtBQUNoQixRQUFJLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztBQUM1QixJQUFFLENBQUM7QUFDSCxJQUNFLElBQUksV0FB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QUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFsQkEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBU0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBWUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBbEdBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQVZBLEFBQUEsQUFFQSxBQUFBLEFBV0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBUUEsQUFBQSxBQUFBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSwgRG9DaGVjaywgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgSW5wdXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0FuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvblBsYXllciwgdXNlQW5pbWF0aW9ufSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcclxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcblxyXG5pbXBvcnQge2NvbGxhcHNlQW5pbWF0aW9uLCBleHBhbmRBbmltYXRpb259IGZyb20gJy4vY29sbGFwc2UuYW5pbWF0aW9ucyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tjQ29sbGFwc2VdJyxcclxuICBleHBvcnRBczogJ2NDb2xsYXBzZScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb2xsYXBzZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIERvQ2hlY2sge1xyXG5cclxuICBASW5wdXQoKSBuYXZiYXI6IGJvb2xlYW47XHJcbiAgQElucHV0KCkgZHVyYXRpb24gPSAnNDAwbXMnO1xyXG4gIEBJbnB1dCgpIHRyYW5zaXRpb24gPSAnZWFzZS1pbi1vdXQnO1xyXG4gIEBJbnB1dCgpIHNob3c6IGJvb2xlYW47XHJcbiAgQElucHV0KCkgYW5pbWF0ZSA9IHRydWU7XHJcblxyXG4gIEBPdXRwdXQoKSBjb2xsYXBzZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG5cclxuICBwcml2YXRlIF9zaG93ID0gZmFsc2U7XHJcbiAgX2FuaW1hdGUgPSB0aGlzLmFuaW1hdGU7XHJcblxyXG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBob3N0OiBIVE1MRWxlbWVudDtcclxuXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgZ2V0IGdldENsYXNzZXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5ob3N0Q2xhc3NlcztcclxuICB9XHJcblxyXG4gIGdldCBob3N0Q2xhc3NlcygpIHtcclxuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc05hbWVzKHtcclxuICAgICAgJ25hdmJhci1jb2xsYXBzZSc6ICEhdGhpcy5uYXZiYXIsXHJcbiAgICAgIHNob3c6ICEhdGhpcy5zaG93LFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gY2xhc3NlcztcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBob3N0RWxlbWVudDogRWxlbWVudFJlZixcclxuICAgIHByaXZhdGUgYW5pbWF0aW9uQnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlclxyXG4gICkge1xyXG4gICAgdGhpcy5ob3N0ID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLl9zaG93ID0gdGhpcy5zaG93O1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRlc3Ryb3lQbGF5ZXIoKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLnNob3cpIHtcclxuICAgICAgKCFjaGFuZ2VzLnNob3cuZmlyc3RDaGFuZ2UgfHwgIWNoYW5nZXMuc2hvdy5jdXJyZW50VmFsdWUpICYmIHRoaXMudG9nZ2xlKGNoYW5nZXMuc2hvdy5jdXJyZW50VmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdEb0NoZWNrKCkge1xyXG4gICAgaWYgKHRoaXMuX3Nob3cgIT09IHRoaXMuc2hvdykgeyB0aGlzLnRvZ2dsZSgpOyB9XHJcbiAgfVxyXG5cclxuICB0b2dnbGUoc2hvdyA9IHRoaXMuc2hvdykge1xyXG4gICAgdGhpcy5fc2hvdyA9IHNob3c7XHJcbiAgICB0aGlzLmNyZWF0ZVBsYXllcihzaG93KTtcclxuICAgIHRoaXMucGxheWVyLnBsYXkoKTtcclxuICB9XHJcblxyXG4gIGRlc3Ryb3lQbGF5ZXIoKSB7XHJcbiAgICBpZiAodGhpcy5wbGF5ZXIpIHtcclxuICAgICAgdGhpcy5wbGF5ZXIuZGVzdHJveSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3JlYXRlUGxheWVyKHNob3cgPSB0aGlzLnNob3cpIHtcclxuICAgIGlmICh0aGlzLnBsYXllcikge1xyXG4gICAgICB0aGlzLmRlc3Ryb3lQbGF5ZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgYW5pbWF0aW9uRmFjdG9yeTtcclxuXHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IHRoaXMuX2FuaW1hdGUgPyB0aGlzLmR1cmF0aW9uIDogJzBtcyc7XHJcblxyXG4gICAgLy8gY29uc29sZS5sb2coJ2FuaW1hdGU/JywgdGhpcy5fYW5pbWF0ZSwgJ3Nob3c/Jywgc2hvdyk7XHJcblxyXG4gICAgYW5pbWF0aW9uRmFjdG9yeSA9IHRoaXMuYW5pbWF0aW9uQnVpbGRlci5idWlsZChcclxuICAgICAgdXNlQW5pbWF0aW9uKHNob3cgPyBleHBhbmRBbmltYXRpb24gOiBjb2xsYXBzZUFuaW1hdGlvbiwgeyBwYXJhbXM6IHsgdGltZTogZHVyYXRpb24sIGVhc2luZzogdGhpcy50cmFuc2l0aW9ufX0pXHJcbiAgICApO1xyXG5cclxuICAgIC8vIGlmKHNob3cpIHtcclxuICAgIC8vICAgYW5pbWF0aW9uRmFjdG9yeSA9IHRoaXMuYW5pbWF0aW9uQnVpbGRlci5idWlsZChcclxuICAgIC8vICAgICAgIHVzZUFuaW1hdGlvbihleHBhbmRBbmltYXRpb24sIHsgcGFyYW1zOiB7IHRpbWU6IGR1cmF0aW9uLCBlYXNpbmc6IHRoaXMudHJhbnNpdGlvbn19KVxyXG4gICAgLy8gICAgICk7XHJcbiAgICAvLyB9IGVsc2Uge1xyXG4gICAgLy8gICBhbmltYXRpb25GYWN0b3J5ID0gdGhpcy5hbmltYXRpb25CdWlsZGVyLmJ1aWxkKFxyXG4gICAgLy8gICAgICAgdXNlQW5pbWF0aW9uKGNvbGxhcHNlQW5pbWF0aW9uLCB7IHBhcmFtczogeyB0aW1lOiBkdXJhdGlvbiwgZWFzaW5nOiB0aGlzLnRyYW5zaXRpb259fSlcclxuICAgIC8vICAgICApO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIHRoaXMucGxheWVyID0gYW5pbWF0aW9uRmFjdG9yeS5jcmVhdGUodGhpcy5ob3N0KTtcclxuICAgIHRoaXMucGxheWVyLm9uU3RhcnQoKCkgPT4ge3RoaXMuY29sbGFwc2VDaGFuZ2UuZW1pdChzaG93ID8gJ29wZW5pbmcnIDogJ2NvbGxhcHNpbmcnKTsgfSApO1xyXG4gICAgdGhpcy5wbGF5ZXIub25Eb25lKCgpID0+IHt0aGlzLmNvbGxhcHNlQ2hhbmdlLmVtaXQoc2hvdyA/ICdvcGVuJyA6ICdjb2xsYXBzZWQnKTsgfSApO1xyXG4gIH1cclxufVxyXG4iXX0=
import { Component, ElementRef, EventEmitter, HostBinding, Input, Output, Renderer2, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { transition, trigger, style, state, animate } from '@angular/animations';
import classNames from 'classnames';
export class AlertComponent {
    constructor(sanitizer, hostElement, renderer) {
        this.sanitizer = sanitizer;
        this.hostElement = hostElement;
        this.renderer = renderer;
        this.color = 'info';
        this.closeButton = false;
        this.show = true;
        this.fade = false;
        this.iconHtml = '<span>&times;</span>';
        this.timeout = 0;
        this.dismissed = new EventEmitter();
        this.timer = new EventEmitter();
    }
    get clock() {
        const time = this._clock;
        this.timer.emit(time);
        return time;
    }
    get animationDisabled() {
        return !this.fade;
    }
    get animateType() {
        return this.show ? 'show' : 'hide';
    }
    get getClasses() {
        return this.hostClasses;
    }
    get hostClasses() {
        const classes = classNames({
            alert: true,
            'alert-dismissible': !!this.closeButton,
            [`alert-${this.color}`]: !!this.color
        });
        return classes;
    }
    ngOnInit() {
        this.safeIcon = this.sanitizer.sanitize(SecurityContext.HTML, this.iconHtml);
        if (this.show && this.timeout) {
            this.setTimer();
        }
    }
    ngOnDestroy() {
        this.clearTimer();
        this.clearClock();
    }
    ngOnChanges(changes) {
        if (changes.color) {
            this.renderer.removeClass(this.hostElement.nativeElement, `alert-${changes.color.previousValue}`);
        }
        if (changes.timeout) {
            this.setTimer();
        }
    }
    setTimer() {
        this.clearTimer();
        this.timerId = this.timeout > 0 ? setTimeout(() => this.onClose(), this.timeout) : null;
        this.setClock();
    }
    clearTimer() {
        clearTimeout(this.timerId);
        this.timerId = null;
    }
    onClose() {
        this.clearTimer();
        if (this.show) {
            this.show = false;
            this.hide = true;
            this.dismissed.emit(this);
        }
    }
    setClock() {
        this.clearClock();
        this._clock = 0;
        this.clockId = setInterval(() => {
            this._clock += 1;
        }, 1000);
        setTimeout(() => {
            this.clearClock();
        }, this.timeout);
    }
    clearClock() {
        clearInterval(this.clockId);
        this.clockId = null;
    }
    onAnimationEvent(event) {
        console.warn(event);
        if (event.phaseName === 'done' && event.toState === 'hide') {
        }
        if (event.phaseName === 'start' && event.toState === 'show') {
        }
    }
}
AlertComponent.decorators = [
    { type: Component, args: [{
                selector: 'c-alert',
                template: "<!--<div [@fadeInOut]=\"show ? 'show' : 'hide'\" [class]=\"alertClasses\">-->\n<ng-container>\n  <ng-template [ngIf]=\"closeButton\">\n    <button type=\"button\" class=\"close\" aria-label=\"Close\" (click)=\"onClose()\">\n      <span aria-hidden=\"true\" [innerHTML]=\"safeIcon\"></span>\n      <span class=\"sr-only\">Close</span>\n    </button>\n  </ng-template>\n  <ng-content></ng-content>\n</ng-container>\n",
                animations: [
                    trigger('fadeInOut', [
                        state('show', style({ opacity: 1 })),
                        state('hide', style({ opacity: 0, height: 0, padding: 0, border: 0, margin: 0 })),
                        transition('show => hide', [
                            animate('.3s ease-out', style({ opacity: 0 })),
                            animate('.3s ease-out', style({ height: 0, padding: 0, border: 0, margin: 0 }))
                        ]),
                        transition('hide => show', [
                            animate('.3s ease-in', style({ height: '*', padding: '*', border: '*', margin: '*' })),
                            animate('.3s ease-in', style({ opacity: '*' }))
                        ])
                    ])
                ],
                styles: [":host{display:block}"]
            },] }
];
AlertComponent.ctorParameters = () => [
    { type: DomSanitizer },
    { type: ElementRef },
    { type: Renderer2 }
];
AlertComponent.propDecorators = {
    color: [{ type: Input }],
    closeButton: [{ type: Input }],
    show: [{ type: Input }],
    fade: [{ type: Input }],
    iconHtml: [{ type: Input }],
    timeout: [{ type: Input }],
    dismissed: [{ type: Output }],
    timer: [{ type: Output }],
    animationDisabled: [{ type: HostBinding, args: ['@.disabled',] }],
    animateType: [{ type: HostBinding, args: ['@fadeInOut',] }],
    getClasses: [{ type: HostBinding, args: ['class',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY29yZXVpLWFuZ3VsYXIvc3JjL2xpYi9hbGVydC9hbGVydC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxLQUFLLEVBSUwsTUFBTSxFQUNOLFNBQVMsRUFDVCxlQUFlLEVBRWhCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQWUsVUFBVSxFQUFFLE9BQU8sRUFBa0IsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFzQ3BDLE1BQU0sT0FBTyxjQUFjO0lBOER6QixZQUNVLFNBQXVCLEVBQ3ZCLFdBQXVCLEVBQ3ZCLFFBQW1CO1FBRm5CLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFDdkIsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUFDdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQWxEcEIsVUFBSyxHQUFHLE1BQU0sQ0FBQztRQUNmLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLFNBQUksR0FBRyxJQUFJLENBQUM7UUFDWixTQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2IsYUFBUSxHQUFHLHNCQUFzQixDQUFDO1FBQ2xDLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFFWCxjQUFTLEdBQWlDLElBQUksWUFBWSxFQUFFLENBQUM7UUFDN0QsVUFBSyxHQUF5QixJQUFJLFlBQVksRUFBRSxDQUFDO0lBNkMzRCxDQUFDO0lBM0RELElBQUksS0FBSztRQUNQLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssQ0FB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QUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO3lCQUM5RSxDQUFDO3dCQUNGLFVBQVUsQ0FBQyxjQUFjLEVBQUU7NEJBQ3pCLE9BQU8sQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7NEJBQ3BGLE9BQU8sQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLEVBQUMsT0FBTyxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7eUJBQzlDLENBQUM7cUJBQ0gsQ0FBQztpQkFjSDs7YUFDRjs7O1lBdkNPLFlBQVk7WUFabEIsVUFBVTtZQVFWLFNBQVM7OztvQkEyRFIsS0FBSzswQkFDTCxLQUFLO21CQUNMLEtBQUs7bUJBQ0wsS0FBSzt1QkFDTCxLQUFLO3NCQUNMLEtBQUs7d0JBRUwsTUFBTTtvQkFDTixNQUFNO2dDQVNOLFdBQVcsU0FBQyxZQUFZOzBCQUt4QixXQUFXLFNBQUMsWUFBWTt5QkFNeEIsV0FBVyxTQUFDLE9BQU8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE91dHB1dCxcclxuICBSZW5kZXJlcjIsXHJcbiAgU2VjdXJpdHlDb250ZXh0LFxyXG4gIFNpbXBsZUNoYW5nZXNcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtEb21TYW5pdGl6ZXJ9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQge3VzZUFuaW1hdGlvbiwgdHJhbnNpdGlvbiwgdHJpZ2dlciwgQW5pbWF0aW9uRXZlbnQsIHN0eWxlLCBzdGF0ZSwgYW5pbWF0ZX0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XHJcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xyXG5cclxuaW1wb3J0IHsgc2hvd0FuaW1hdGlvbiwgaGlkZUFuaW1hdGlvbiB9IGZyb20gJy4vYWxlcnQuYW5pbWF0aW9ucyc7XHJcblxyXG50eXBlIEFuaW1hdGVUeXBlID0gKCAnaGlkZScgfCAnc2hvdycgKTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYy1hbGVydCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FsZXJ0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9hbGVydC5jb21wb25lbnQuc2NzcyddLFxyXG4gIGFuaW1hdGlvbnM6IFtcclxuICAgIHRyaWdnZXIoJ2ZhZGVJbk91dCcsIFtcclxuICAgICAgc3RhdGUoJ3Nob3cnLCBzdHlsZSh7b3BhY2l0eTogMX0pKSxcclxuICAgICAgc3RhdGUoJ2hpZGUnLCBzdHlsZSh7b3BhY2l0eTogMCwgaGVpZ2h0OiAwLCBwYWRkaW5nOiAwLCBib3JkZXI6IDAsIG1hcmdpbjogMCB9KSksXHJcbiAgICAgIHRyYW5zaXRpb24oJ3Nob3cgPT4gaGlkZScsIFtcclxuICAgICAgICBhbmltYXRlKCcuM3MgZWFzZS1vdXQnLCBzdHlsZSh7b3BhY2l0eTogMH0pKSxcclxuICAgICAgICBhbmltYXRlKCcuM3MgZWFzZS1vdXQnLCBzdHlsZSh7aGVpZ2h0OiAwLCBwYWRkaW5nOiAwLCBib3JkZXI6IDAsIG1hcmdpbjogMH0pKVxyXG4gICAgICBdKSxcclxuICAgICAgdHJhbnNpdGlvbignaGlkZSA9PiBzaG93JywgW1xyXG4gICAgICAgIGFuaW1hdGUoJy4zcyBlYXNlLWluJywgc3R5bGUoe2hlaWdodDogJyonLCBwYWRkaW5nOiAnKicsIGJvcmRlcjogJyonLCBtYXJnaW46ICcqJ30pKSxcclxuICAgICAgICBhbmltYXRlKCcuM3MgZWFzZS1pbicsIHN0eWxlKHtvcGFjaXR5OiAnKid9KSlcclxuICAgICAgXSlcclxuICAgIF0pXHJcblxyXG4gICAgLy8gdHJpZ2dlcignZmFkZUluT3V0JywgW1xyXG4gICAgLy8gICB0cmFuc2l0aW9uKCcqID0+IHNob3cnLCBbXHJcbiAgICAvLyAgICAgdXNlQW5pbWF0aW9uKHNob3dBbmltYXRpb24sIHtcclxuICAgIC8vICAgICAgIHBhcmFtczogeyB0aW1lOiAnNjAwbXMnLCBlYXNpbmc6ICdlYXNlLWluJyB9XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgXSksXHJcbiAgICAvLyAgIHRyYW5zaXRpb24oJ3Nob3cgPT4gaGlkZScsIFtcclxuICAgIC8vICAgICB1c2VBbmltYXRpb24oaGlkZUFuaW1hdGlvbiwge1xyXG4gICAgLy8gICAgICAgcGFyYW1zOiB7IHRpbWU6ICc2MDBtcycsIGVhc2luZzogJ2Vhc2Utb3V0JyB9XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgXSksXHJcbiAgICAvLyBdKSxcclxuICBdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQWxlcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuXHJcbiAgc2FmZUljb247XHJcbiAgdGltZXJJZDogYW55O1xyXG4gIGFuaW1hdGU6IEFuaW1hdGVUeXBlO1xyXG4gIGhpZGU6IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSBjbG9ja0lkOiBhbnk7XHJcbiAgcHJpdmF0ZSBfY2xvY2s6IG51bWJlcjtcclxuXHJcbiAgZ2V0IGNsb2NrKCkge1xyXG4gICAgY29uc3QgdGltZSA9IHRoaXMuX2Nsb2NrO1xyXG4gICAgdGhpcy50aW1lci5lbWl0KHRpbWUpO1xyXG4gICAgcmV0dXJuIHRpbWU7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBjb2xvciA9ICdpbmZvJztcclxuICBASW5wdXQoKSBjbG9zZUJ1dHRvbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHNob3cgPSB0cnVlO1xyXG4gIEBJbnB1dCgpIGZhZGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSBpY29uSHRtbCA9ICc8c3Bhbj4mdGltZXM7PC9zcGFuPic7XHJcbiAgQElucHV0KCkgdGltZW91dCA9IDA7XHJcblxyXG4gIEBPdXRwdXQoKSBkaXNtaXNzZWQ6IEV2ZW50RW1pdHRlcjxBbGVydENvbXBvbmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHRpbWVyOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgLy8gQEhvc3RMaXN0ZW5lcignQGZhZGVJbk91dC5zdGFydCcsIFsnJGV2ZW50J10gKSBvbkFuaW1hdGlvblN0YXJ0KCRldmVudCkge1xyXG4gIC8vICAgdGhpcy5vbkFuaW1hdGlvbkV2ZW50KCRldmVudClcclxuICAvLyB9XHJcbiAgLy8gQEhvc3RMaXN0ZW5lcignQGZhZGVJbk91dC5kb25lJywgWyckZXZlbnQnXSkgb25BbmltYXRpb25Eb25lKCRldmVudCkge1xyXG4gIC8vICAgdGhpcy5vbkFuaW1hdGlvbkV2ZW50KCRldmVudClcclxuICAvLyB9XHJcblxyXG4gIEBIb3N0QmluZGluZygnQC5kaXNhYmxlZCcpXHJcbiAgZ2V0IGFuaW1hdGlvbkRpc2FibGVkKCkge1xyXG4gICAgcmV0dXJuICF0aGlzLmZhZGU7XHJcbiAgfVxyXG5cclxuICBASG9zdEJpbmRpbmcoJ0BmYWRlSW5PdXQnKVxyXG4gIGdldCBhbmltYXRlVHlwZSgpOiBBbmltYXRlVHlwZSB7XHJcbiAgICAvLyByZXR1cm4gdGhpcy5hbmltYXRlO1xyXG4gICAgcmV0dXJuIHRoaXMuc2hvdyA/ICdzaG93JyA6ICdoaWRlJztcclxuICB9XHJcblxyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxyXG4gIGdldCBnZXRDbGFzc2VzKCkge1xyXG4gICAgLy8gcmV0dXJuIHRoaXMuYWxlcnRDbGFzc2VzO1xyXG4gICAgcmV0dXJuIHRoaXMuaG9zdENsYXNzZXM7XHJcbiAgfVxyXG5cclxuICAvLyBnZXQgYWxlcnRDbGFzc2VzKCkge1xyXG4gIGdldCBob3N0Q2xhc3NlcygpIHtcclxuXHJcbiAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyhcclxuICAgICAge1xyXG4gICAgICAgIGFsZXJ0OiB0cnVlLFxyXG4gICAgICAgICdhbGVydC1kaXNtaXNzaWJsZSc6ICEhdGhpcy5jbG9zZUJ1dHRvbixcclxuICAgICAgICBbYGFsZXJ0LSR7dGhpcy5jb2xvcn1gXTogISF0aGlzLmNvbG9yXHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIGNsYXNzZXM7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXHJcbiAgICBwcml2YXRlIGhvc3RFbGVtZW50OiBFbGVtZW50UmVmLFxyXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyXHJcbiAgKSB7XHJcbiAgICAvLyB0aGlzLnNhZmVJY29uID0gc2FuaXRpemVyLnNhbml0aXplKFNlY3VyaXR5Q29udGV4dC5IVE1MLCB0aGlzLmljb25IdG1sKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5zYWZlSWNvbiA9IHRoaXMuc2FuaXRpemVyLnNhbml0aXplKFNlY3VyaXR5Q29udGV4dC5IVE1MLCB0aGlzLmljb25IdG1sKTtcclxuICAgIGlmICh0aGlzLnNob3cgJiYgdGhpcy50aW1lb3V0KSB7XHJcbiAgICAgIHRoaXMuc2V0VGltZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jbGVhclRpbWVyKCk7XHJcbiAgICB0aGlzLmNsZWFyQ2xvY2soKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBpZiAoY2hhbmdlcy5jb2xvcikge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCwgYGFsZXJ0LSR7Y2hhbmdlcy5jb2xvci5wcmV2aW91c1ZhbHVlfWApO1xyXG4gICAgfVxyXG4gICAgaWYgKGNoYW5nZXMudGltZW91dCkge1xyXG4gICAgICB0aGlzLnNldFRpbWVyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRUaW1lcigpIHtcclxuICAgIHRoaXMuY2xlYXJUaW1lcigpO1xyXG4gICAgdGhpcy50aW1lcklkID0gdGhpcy50aW1lb3V0ID4gMCA/IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5vbkNsb3NlKCksIHRoaXMudGltZW91dCkgOiBudWxsO1xyXG4gICAgdGhpcy5zZXRDbG9jaygpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXJUaW1lcigpIHtcclxuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVySWQpO1xyXG4gICAgdGhpcy50aW1lcklkID0gbnVsbDtcclxuICB9XHJcblxyXG4gIG9uQ2xvc2UoKSB7XHJcbiAgICB0aGlzLmNsZWFyVGltZXIoKTtcclxuICAgIGlmICh0aGlzLnNob3cpIHtcclxuICAgICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuaGlkZSA9IHRydWU7XHJcbiAgICAgIHRoaXMuZGlzbWlzc2VkLmVtaXQodGhpcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRDbG9jaygpIHtcclxuICAgIHRoaXMuY2xlYXJDbG9jaygpO1xyXG4gICAgdGhpcy5fY2xvY2sgPSAwO1xyXG4gICAgdGhpcy5jbG9ja0lkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLl9jbG9jayArPSAxO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5jbGVhckNsb2NrKCk7XHJcbiAgICB9LCB0aGlzLnRpbWVvdXQpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXJDbG9jaygpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jbG9ja0lkKTtcclxuICAgIHRoaXMuY2xvY2tJZCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBvbkFuaW1hdGlvbkV2ZW50KCBldmVudDogQW5pbWF0aW9uRXZlbnQgKSB7XHJcbiAgICBjb25zb2xlLndhcm4oZXZlbnQpO1xyXG4gICAgaWYgKGV2ZW50LnBoYXNlTmFtZSA9PT0gJ2RvbmUnICYmIGV2ZW50LnRvU3RhdGUgPT09ICdoaWRlJykge1xyXG4gICAgICAvLyB0aGlzLmhpZGUgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChldmVudC5waGFzZU5hbWUgPT09ICdzdGFydCcgJiYgZXZlbnQudG9TdGF0ZSA9PT0gJ3Nob3cnKSB7XHJcbiAgICAgIC8vIHRoaXMuaGlkZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gb3BlbkNsb3NlIGlzIHRyaWdnZXIgbmFtZSBpbiB0aGlzIGV4YW1wbGVcclxuICAgIC8vIGNvbnNvbGUud2FybihgQW5pbWF0aW9uIFRyaWdnZXI6ICR7ZXZlbnQudHJpZ2dlck5hbWV9YCk7XHJcbiAgICAvL1xyXG4gICAgLy8gLy8gcGhhc2VOYW1lIGlzIHN0YXJ0IG9yIGRvbmVcclxuICAgIC8vIGNvbnNvbGUud2FybihgUGhhc2U6ICR7ZXZlbnQucGhhc2VOYW1lfWApO1xyXG4gICAgLy9cclxuICAgIC8vIC8vIGluIG91ciBleGFtcGxlLCB0b3RhbFRpbWUgaXMgMTAwMCBvciAxIHNlY29uZFxyXG4gICAgLy8gY29uc29sZS53YXJuKGBUb3RhbCB0aW1lOiAke2V2ZW50LnRvdGFsVGltZX1gKTtcclxuICAgIC8vXHJcbiAgICAvLyAvLyBpbiBvdXIgZXhhbXBsZSwgZnJvbVN0YXRlIGlzIGVpdGhlciBvcGVuIG9yIGNsb3NlZFxyXG4gICAgLy8gY29uc29sZS53YXJuKGBGcm9tOiAke2V2ZW50LmZyb21TdGF0ZX1gKTtcclxuICAgIC8vXHJcbiAgICAvLyAvLyBpbiBvdXIgZXhhbXBsZSwgdG9TdGF0ZSBlaXRoZXIgb3BlbiBvciBjbG9zZWRcclxuICAgIC8vIGNvbnNvbGUud2FybihgVG86ICR7ZXZlbnQudG9TdGF0ZX1gKTtcclxuICAgIC8vXHJcbiAgICAvLyAvLyB0aGUgSFRNTCBlbGVtZW50IGl0c2VsZiwgdGhlIGJ1dHRvbiBpbiB0aGlzIGNhc2VcclxuICAgIC8vIGNvbnNvbGUud2FybihgRWxlbWVudDogJHtldmVudC5lbGVtZW50fWApO1xyXG4gIH1cclxufVxyXG4iXX0=
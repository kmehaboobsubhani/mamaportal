import { Injectable, RendererFactory2, isDevMode } from '@angular/core';
import { Subject } from 'rxjs';
import tippy, { hideAll } from 'tippy.js';
import * as i0 from "@angular/core";
export class NgxTippyService {
    constructor(rendererFactory) {
        this.tippyInstances = new Map();
        this.tippyInstances$ = new Subject();
        this.createRenderer(rendererFactory);
    }
    /**
     * Working with storage
     */
    /**
     * Write tippy instances to storage
     *
     * @param name { string } name of tippy instance
     * @param state { NgxTippyInstance } tippy instance
     */
    setInstance(name, state) {
        this.tippyInstances.set(name, state);
        this.emitInstancesChange('setInstance', name);
    }
    /**
     * Get specific tippy instance
     *
     * @param name { string } name of tippy instance
     * @returns { NgxTippyInstance | null } specific tippy instance or null
     */
    getInstance(name) {
        return this.tippyInstances.has(name) ? this.tippyInstances.get(name) : null;
    }
    /**
     * Get all tippy instances from storage
     *
     * @returns { Map<string, NgxTippyInstance> | null } all tippy instances or null
     */
    getInstances() {
        return this.tippyInstances.size ? this.tippyInstances : null;
    }
    /**
     * Working with tippy instance methods
     */
    /**
     * Programmatically show the tippy
     *
     * @param name { string } name of tippy instance
     */
    show(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).show();
        this.emitInstancesChange('show', name);
    }
    /**
     * Programmatically hide the tippy
     *
     * @param name { string } name of tippy instance
     */
    hide(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).hide();
        this.emitInstancesChange('hide', name);
    }
    /**
     * Will hide the tippy only if the cursor is outside of the tippy's interactive region
     * This allows you to programmatically hook into interactive behavior upon a mouseleave event if implementing custom event listeners
     *
     * @param name { string } name of tippy instance
     * @param name { mouseEvent } pass the mouse event object in from your event listener
     */
    hideWithInteractivity(name, mouseEvent) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).hideWithInteractivity(mouseEvent);
        this.emitInstancesChange('hideWithInteractivity', name);
    }
    /**
     * Prevent a tippy from showing or hiding
     *
     * @param name { string } name of tippy instance
     */
    disable(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).disable();
        this.emitInstancesChange('disable', name);
    }
    /**
     * Re-enable a tippy
     *
     * @param name { string } name of tippy instance
     */
    enable(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).enable();
        this.emitInstancesChange('enable', name);
    }
    /**
     * Update any tippy props
     *
     * @param name { string } name of tippy instance
     * @param tippyProps { NgxTippyProps } new props
     */
    setProps(name, tippyProps) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).setProps(tippyProps);
        this.emitInstancesChange('setProps', name);
    }
    /**
     * Update the content for tippy
     *
     * @param name { string } name of tippy instance
     * @param tippyContent { NgxTippyContent } new content
     */
    setContent(name, tippyContent) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.setTemplateVisible(tippyContent);
        this.tippyInstances.get(name).setContent(tippyContent);
        this.emitInstancesChange('setContent', name);
    }
    /**
     * The element(s) that the trigger event listeners are added to
     * Allows you to separate the tippy's positioning from its trigger source
     *
     * @param name { string } name of tippy instance
     * @param triggerTarget { Element | Element[] } element(s) that the trigger tooltip
     */
    setTriggerTarget(name, triggerTarget) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).setProps({ triggerTarget });
        this.emitInstancesChange('setTriggerTarget', name);
    }
    /**
     * Unmount the tippy from the DOM
     *
     * @param name { string } name of tippy instance
     */
    unmount(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).unmount();
        this.emitInstancesChange('unmount', name);
    }
    /**
     * Clears the instances delay timeouts
     *
     * @param name { string } name of tippy instance
     */
    clearDelayTimeouts(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).clearDelayTimeouts();
        this.emitInstancesChange('clearDelayTimeouts', name);
    }
    /**
     * Permanently destroy and clean up the tippy instance
     *
     * @param name { string } name of tippy instance
     */
    destroy(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).destroy();
        this.emitInstancesChange('destroy', name);
        this.tippyInstances.delete(name);
    }
    /** Working with tippy static methods */
    /**
     * Set the default props for each new tippy instance
     *
     * @param tippyProps { NgxTippyProps } default props
     */
    setDefaultProps(tippyProps) {
        tippy.setDefaultProps(tippyProps);
    }
    /**
     * Show all tippies
     */
    showAll() {
        this.tippyInstances.forEach((tippyInstance, key) => {
            tippyInstance.show();
            this.emitInstancesChange('show', key);
        });
    }
    /**
     * Hide all tippies or hide all except a particular one
     * Additional hide them with duration
     *
     * @param { NgxHideAllOptions } [options] - additional hiding options
     */
    hideAll(options) {
        const exclude = options && this.tippyInstances.has(options.excludeName) && this.tippyInstances.get(options.excludeName);
        const duration = options && options.duration;
        hideAll({ duration, exclude });
    }
    /**
     * Subscription to change of tippy instances
     *
     * @returns { Observable<InstancesChanges> } observable of tippy instances change
     */
    get instancesChanges() {
        return this.tippyInstances$.asObservable();
    }
    /**
     * Service methods
     */
    setTemplateVisible(tippyContent) {
        tippyContent instanceof Element && this.renderer.setStyle(tippyContent, 'display', 'block');
    }
    emitInstancesChange(reason, name) {
        const instance = this.tippyInstances.get(name);
        this.tippyInstances$.next({ name, reason, instance });
    }
    createRenderer(rendererFactory) {
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    throwError(message, errorConstrictor = Error) {
        if (!isDevMode())
            return;
        throw new errorConstrictor(message);
    }
}
NgxTippyService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgxTippyService_Factory() { return new NgxTippyService(i0.ɵɵinject(i0.RendererFactory2)); }, token: NgxTippyService, providedIn: "root" });
NgxTippyService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
NgxTippyService.ctorParameters = () => [
    { type: RendererFactory2 }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXRpcHB5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vcHJvamVjdHMvbmd4LXRpcHB5LXdyYXBwZXIvc3JjLyIsInNvdXJjZXMiOlsibGliL25neC10aXBweS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWEsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25GLE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxLQUFLLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxVQUFVLENBQUM7O0FBYTFDLE1BQU0sT0FBTyxlQUFlO0lBSzFCLFlBQVksZUFBaUM7UUFKckMsbUJBQWMsR0FBa0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUMxRCxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUFvQixDQUFDO1FBSXhELElBQUksQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVEOztPQUVHO0lBRUg7Ozs7O09BS0c7SUFDSCxXQUFXLENBQUMsSUFBWSxFQUFFLEtBQXVCO1FBQy9DLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFdBQVcsQ0FBQyxJQUFZO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDOUUsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxZQUFZO1FBQ1YsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FB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QztJQUM3RCxDQUFDO0lBRU8sVUFBVSxDQUFDLE9BQWUsRUFBRSxtQkFBcUMsS0FBSztRQUM1RSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQUUsT0FBTztRQUN6QixNQUFNLElBQUksZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdEMsQ0FBQzs7OztZQW5SRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7OztZQWQrQixnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBSZW5kZXJlcjIsIFJlbmRlcmVyRmFjdG9yeTIsIGlzRGV2TW9kZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHRpcHB5LCB7IGhpZGVBbGwgfSBmcm9tICd0aXBweS5qcyc7XG5pbXBvcnQge1xuICBOZ3hUaXBweUluc3RhbmNlLFxuICBOZ3hUaXBweVByb3BzLFxuICBOZ3hUaXBweUNvbnRlbnQsXG4gIE5neEhpZGVBbGxPcHRpb25zLFxuICBJbnN0YW5jZXNDaGFuZ2VzLFxuICBJbnN0YW5jZUNoYW5nZVJlYXNvbixcbn0gZnJvbSAnLi9uZ3gtdGlwcHkuaW50ZXJmYWNlcyc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3hUaXBweVNlcnZpY2Uge1xuICBwcml2YXRlIHRpcHB5SW5zdGFuY2VzOiBNYXA8c3RyaW5nLCBOZ3hUaXBweUluc3RhbmNlPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSB0aXBweUluc3RhbmNlcyQgPSBuZXcgU3ViamVjdDxJbnN0YW5jZXNDaGFuZ2VzPigpO1xuICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjI7XG5cbiAgY29uc3RydWN0b3IocmVuZGVyZXJGYWN0b3J5OiBSZW5kZXJlckZhY3RvcnkyKSB7XG4gICAgdGhpcy5jcmVhdGVSZW5kZXJlcihyZW5kZXJlckZhY3RvcnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdvcmtpbmcgd2l0aCBzdG9yYWdlXG4gICAqL1xuXG4gIC8qKlxuICAgKiBXcml0ZSB0aXBweSBpbnN0YW5jZXMgdG8gc3RvcmFnZVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICogQHBhcmFtIHN0YXRlIHsgTmd4VGlwcHlJbnN0YW5jZSB9IHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBzZXRJbnN0YW5jZShuYW1lOiBzdHJpbmcsIHN0YXRlOiBOZ3hUaXBweUluc3RhbmNlKSB7XG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5zZXQobmFtZSwgc3RhdGUpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnc2V0SW5zdGFuY2UnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3BlY2lmaWMgdGlwcHkgaW5zdGFuY2VcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqIEByZXR1cm5zIHsgTmd4VGlwcHlJbnN0YW5jZSB8IG51bGwgfSBzcGVjaWZpYyB0aXBweSBpbnN0YW5jZSBvciBudWxsXG4gICAqL1xuICBnZXRJbnN0YW5jZShuYW1lOiBzdHJpbmcpOiBOZ3hUaXBweUluc3RhbmNlIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpID8gdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgdGlwcHkgaW5zdGFuY2VzIGZyb20gc3RvcmFnZVxuICAgKlxuICAgKiBAcmV0dXJucyB7IE1hcDxzdHJpbmcsIE5neFRpcHB5SW5zdGFuY2U+IHwgbnVsbCB9IGFsbCB0aXBweSBpbnN0YW5jZXMgb3IgbnVsbFxuICAgKi9cbiAgZ2V0SW5zdGFuY2VzKCk6IE1hcDxzdHJpbmcsIE5neFRpcHB5SW5zdGFuY2U+IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMudGlwcHlJbnN0YW5jZXMuc2l6ZSA/IHRoaXMudGlwcHlJbnN0YW5jZXMgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFdvcmtpbmcgd2l0aCB0aXBweSBpbnN0YW5jZSBtZXRob2RzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBQcm9ncmFtbWF0aWNhbGx5IHNob3cgdGhlIHRpcHB5XG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKi9cbiAgc2hvdyhuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5zaG93KCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzaG93JywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogUHJvZ3JhbW1hdGljYWxseSBoaWRlIHRoZSB0aXBweVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICovXG4gIGhpZGUobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuaGlkZSgpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnaGlkZScsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdpbGwgaGlkZSB0aGUgdGlwcHkgb25seSBpZiB0aGUgY3Vyc29yIGlzIG91dHNpZGUgb2YgdGhlIHRpcHB5J3MgaW50ZXJhY3RpdmUgcmVnaW9uXG4gICAqIFRoaXMgYWxsb3dzIHlvdSB0byBwcm9ncmFtbWF0aWNhbGx5IGhvb2sgaW50byBpbnRlcmFjdGl2ZSBiZWhhdmlvciB1cG9uIGEgbW91c2VsZWF2ZSBldmVudCBpZiBpbXBsZW1lbnRpbmcgY3VzdG9tIGV2ZW50IGxpc3RlbmVyc1xuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICogQHBhcmFtIG5hbWUgeyBtb3VzZUV2ZW50IH0gcGFzcyB0aGUgbW91c2UgZXZlbnQgb2JqZWN0IGluIGZyb20geW91ciBldmVudCBsaXN0ZW5lclxuICAgKi9cbiAgaGlkZVdpdGhJbnRlcmFjdGl2aXR5KG5hbWU6IHN0cmluZywgbW91c2VFdmVudDogTW91c2VFdmVudCkge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLmhpZGVXaXRoSW50ZXJhY3Rpdml0eShtb3VzZUV2ZW50KTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ2hpZGVXaXRoSW50ZXJhY3Rpdml0eScsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXZlbnQgYSB0aXBweSBmcm9tIHNob3dpbmcgb3IgaGlkaW5nXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKi9cbiAgZGlzYWJsZShuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5kaXNhYmxlKCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdkaXNhYmxlJywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogUmUtZW5hYmxlIGEgdGlwcHlcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBlbmFibGUobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuZW5hYmxlKCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdlbmFibGUnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYW55IHRpcHB5IHByb3BzXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKiBAcGFyYW0gdGlwcHlQcm9wcyB7IE5neFRpcHB5UHJvcHMgfSBuZXcgcHJvcHNcbiAgICovXG4gIHNldFByb3BzKG5hbWU6IHN0cmluZywgdGlwcHlQcm9wczogTmd4VGlwcHlQcm9wcykge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLnNldFByb3BzKHRpcHB5UHJvcHMpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnc2V0UHJvcHMnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGNvbnRlbnQgZm9yIHRpcHB5XG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKiBAcGFyYW0gdGlwcHlDb250ZW50IHsgTmd4VGlwcHlDb250ZW50IH0gbmV3IGNvbnRlbnRcbiAgICovXG4gIHNldENvbnRlbnQobmFtZTogc3RyaW5nLCB0aXBweUNvbnRlbnQ6IE5neFRpcHB5Q29udGVudCkge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMuc2V0VGVtcGxhdGVWaXNpYmxlKHRpcHB5Q29udGVudCk7XG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuc2V0Q29udGVudCh0aXBweUNvbnRlbnQpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnc2V0Q29udGVudCcsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBlbGVtZW50KHMpIHRoYXQgdGhlIHRyaWdnZXIgZXZlbnQgbGlzdGVuZXJzIGFyZSBhZGRlZCB0b1xuICAgKiBBbGxvd3MgeW91IHRvIHNlcGFyYXRlIHRoZSB0aXBweSdzIHBvc2l0aW9uaW5nIGZyb20gaXRzIHRyaWdnZXIgc291cmNlXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKiBAcGFyYW0gdHJpZ2dlclRhcmdldCB7IEVsZW1lbnQgfCBFbGVtZW50W10gfSBlbGVtZW50KHMpIHRoYXQgdGhlIHRyaWdnZXIgdG9vbHRpcFxuICAgKi9cbiAgc2V0VHJpZ2dlclRhcmdldChuYW1lOiBzdHJpbmcsIHRyaWdnZXJUYXJnZXQ6IEVsZW1lbnQgfCBFbGVtZW50W10pIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5zZXRQcm9wcyh7IHRyaWdnZXJUYXJnZXQgfSk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzZXRUcmlnZ2VyVGFyZ2V0JywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogVW5tb3VudCB0aGUgdGlwcHkgZnJvbSB0aGUgRE9NXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKi9cbiAgdW5tb3VudChuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS51bm1vdW50KCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCd1bm1vdW50JywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXJzIHRoZSBpbnN0YW5jZXMgZGVsYXkgdGltZW91dHNcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBjbGVhckRlbGF5VGltZW91dHMobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuY2xlYXJEZWxheVRpbWVvdXRzKCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdjbGVhckRlbGF5VGltZW91dHMnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJtYW5lbnRseSBkZXN0cm95IGFuZCBjbGVhbiB1cCB0aGUgdGlwcHkgaW5zdGFuY2VcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBkZXN0cm95KG5hbWU6IHN0cmluZykge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLmRlc3Ryb3koKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ2Rlc3Ryb3knLCBuYW1lKTtcbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmRlbGV0ZShuYW1lKTtcbiAgfVxuXG4gIC8qKiBXb3JraW5nIHdpdGggdGlwcHkgc3RhdGljIG1ldGhvZHMgKi9cblxuICAvKipcbiAgICogU2V0IHRoZSBkZWZhdWx0IHByb3BzIGZvciBlYWNoIG5ldyB0aXBweSBpbnN0YW5jZVxuICAgKlxuICAgKiBAcGFyYW0gdGlwcHlQcm9wcyB7IE5neFRpcHB5UHJvcHMgfSBkZWZhdWx0IHByb3BzXG4gICAqL1xuICBzZXREZWZhdWx0UHJvcHModGlwcHlQcm9wczogTmd4VGlwcHlQcm9wcykge1xuICAgIHRpcHB5LnNldERlZmF1bHRQcm9wcyh0aXBweVByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGFsbCB0aXBwaWVzXG4gICAqL1xuICBzaG93QWxsKCkge1xuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZm9yRWFjaCgodGlwcHlJbnN0YW5jZTogTmd4VGlwcHlJbnN0YW5jZSwga2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIHRpcHB5SW5zdGFuY2Uuc2hvdygpO1xuICAgICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzaG93Jywga2V5KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIGFsbCB0aXBwaWVzIG9yIGhpZGUgYWxsIGV4Y2VwdCBhIHBhcnRpY3VsYXIgb25lXG4gICAqIEFkZGl0aW9uYWwgaGlkZSB0aGVtIHdpdGggZHVyYXRpb25cbiAgICpcbiAgICogQHBhcmFtIHsgTmd4SGlkZUFsbE9wdGlvbnMgfSBbb3B0aW9uc10gLSBhZGRpdGlvbmFsIGhpZGluZyBvcHRpb25zXG4gICAqL1xuICBoaWRlQWxsKG9wdGlvbnM/OiBOZ3hIaWRlQWxsT3B0aW9ucykge1xuICAgIGNvbnN0IGV4Y2x1ZGUgPVxuICAgICAgb3B0aW9ucyAmJiB0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhvcHRpb25zLmV4Y2x1ZGVOYW1lKSAmJiB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChvcHRpb25zLmV4Y2x1ZGVOYW1lKTtcbiAgICBjb25zdCBkdXJhdGlvbiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kdXJhdGlvbjtcblxuICAgIGhpZGVBbGwoeyBkdXJhdGlvbiwgZXhjbHVkZSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdWJzY3JpcHRpb24gdG8gY2hhbmdlIG9mIHRpcHB5IGluc3RhbmNlc1xuICAgKlxuICAgKiBAcmV0dXJucyB7IE9ic2VydmFibGU8SW5zdGFuY2VzQ2hhbmdlcz4gfSBvYnNlcnZhYmxlIG9mIHRpcHB5IGluc3RhbmNlcyBjaGFuZ2VcbiAgICovXG4gIGdldCBpbnN0YW5jZXNDaGFuZ2VzKCk6IE9ic2VydmFibGU8SW5zdGFuY2VzQ2hhbmdlcz4ge1xuICAgIHJldHVybiB0aGlzLnRpcHB5SW5zdGFuY2VzJC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXJ2aWNlIG1ldGhvZHNcbiAgICovXG4gIHB1YmxpYyBzZXRUZW1wbGF0ZVZpc2libGUodGlwcHlDb250ZW50OiBOZ3hUaXBweUNvbnRlbnQpIHtcbiAgICB0aXBweUNvbnRlbnQgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGlwcHlDb250ZW50LCAnZGlzcGxheScsICdibG9jaycpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0SW5zdGFuY2VzQ2hhbmdlKHJlYXNvbjogSW5zdGFuY2VDaGFuZ2VSZWFzb24sIG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSk7XG4gICAgdGhpcy50aXBweUluc3RhbmNlcyQubmV4dCh7IG5hbWUsIHJlYXNvbiwgaW5zdGFuY2UgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVJlbmRlcmVyKHJlbmRlcmVyRmFjdG9yeTogUmVuZGVyZXJGYWN0b3J5Mikge1xuICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlckZhY3RvcnkuY3JlYXRlUmVuZGVyZXIobnVsbCwgbnVsbCk7XG4gIH1cblxuICBwcml2YXRlIHRocm93RXJyb3IobWVzc2FnZTogc3RyaW5nLCBlcnJvckNvbnN0cmljdG9yOiBFcnJvckNvbnN0cnVjdG9yID0gRXJyb3IpIHtcbiAgICBpZiAoIWlzRGV2TW9kZSgpKSByZXR1cm47XG4gICAgdGhyb3cgbmV3IGVycm9yQ29uc3RyaWN0b3IobWVzc2FnZSk7XG4gIH1cbn1cbiJdfQ==
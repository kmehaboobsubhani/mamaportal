import { Injectable, RendererFactory2, isDevMode } from '@angular/core';
import { Subject } from 'rxjs';
import tippy, { hideAll } from 'tippy.js';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export class NgxTippyService {
    constructor(rendererFactory) {
        this.tippyInstances = new Map();
        this.tippyInstances$ = new Subject();
        this.createRenderer(rendererFactory);
    }
    /**
     * Working with storage
     */
    /**
     * Write tippy instances to storage
     *
     * @param name { string } name of tippy instance
     * @param state { NgxTippyInstance } tippy instance
     */
    setInstance(name, state) {
        this.tippyInstances.set(name, state);
        this.emitInstancesChange('setInstance', name);
    }
    /**
     * Get specific tippy instance
     *
     * @param name { string } name of tippy instance
     * @returns { NgxTippyInstance | null } specific tippy instance or null
     */
    getInstance(name) {
        return this.tippyInstances.has(name) ? this.tippyInstances.get(name) : null;
    }
    /**
     * Get all tippy instances from storage
     *
     * @returns { Map<string, NgxTippyInstance> | null } all tippy instances or null
     */
    getInstances() {
        return this.tippyInstances.size ? this.tippyInstances : null;
    }
    /**
     * Working with tippy instance methods
     */
    /**
     * Programmatically show the tippy
     *
     * @param name { string } name of tippy instance
     */
    show(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).show();
        this.emitInstancesChange('show', name);
    }
    /**
     * Programmatically hide the tippy
     *
     * @param name { string } name of tippy instance
     */
    hide(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).hide();
        this.emitInstancesChange('hide', name);
    }
    /**
     * Will hide the tippy only if the cursor is outside of the tippy's interactive region
     * This allows you to programmatically hook into interactive behavior upon a mouseleave event if implementing custom event listeners
     *
     * @param name { string } name of tippy instance
     * @param name { mouseEvent } pass the mouse event object in from your event listener
     */
    hideWithInteractivity(name, mouseEvent) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).hideWithInteractivity(mouseEvent);
        this.emitInstancesChange('hideWithInteractivity', name);
    }
    /**
     * Prevent a tippy from showing or hiding
     *
     * @param name { string } name of tippy instance
     */
    disable(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).disable();
        this.emitInstancesChange('disable', name);
    }
    /**
     * Re-enable a tippy
     *
     * @param name { string } name of tippy instance
     */
    enable(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).enable();
        this.emitInstancesChange('enable', name);
    }
    /**
     * Update any tippy props
     *
     * @param name { string } name of tippy instance
     * @param tippyProps { NgxTippyProps } new props
     */
    setProps(name, tippyProps) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).setProps(tippyProps);
        this.emitInstancesChange('setProps', name);
    }
    /**
     * Update the content for tippy
     *
     * @param name { string } name of tippy instance
     * @param tippyContent { NgxTippyContent } new content
     */
    setContent(name, tippyContent) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.setTemplateVisible(tippyContent);
        this.tippyInstances.get(name).setContent(tippyContent);
        this.emitInstancesChange('setContent', name);
    }
    /**
     * The element(s) that the trigger event listeners are added to
     * Allows you to separate the tippy's positioning from its trigger source
     *
     * @param name { string } name of tippy instance
     * @param triggerTarget { Element | Element[] } element(s) that the trigger tooltip
     */
    setTriggerTarget(name, triggerTarget) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).setProps({ triggerTarget });
        this.emitInstancesChange('setTriggerTarget', name);
    }
    /**
     * Unmount the tippy from the DOM
     *
     * @param name { string } name of tippy instance
     */
    unmount(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).unmount();
        this.emitInstancesChange('unmount', name);
    }
    /**
     * Clears the instances delay timeouts
     *
     * @param name { string } name of tippy instance
     */
    clearDelayTimeouts(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).clearDelayTimeouts();
        this.emitInstancesChange('clearDelayTimeouts', name);
    }
    /**
     * Permanently destroy and clean up the tippy instance
     *
     * @param name { string } name of tippy instance
     */
    destroy(name) {
        if (!this.tippyInstances.has(name)) {
            this.throwError(`Instance with identifier '${name}' does not exist`);
        }
        this.tippyInstances.get(name).destroy();
        this.emitInstancesChange('destroy', name);
        this.tippyInstances.delete(name);
    }
    /** Working with tippy static methods */
    /**
     * Set the default props for each new tippy instance
     *
     * @param tippyProps { NgxTippyProps } default props
     */
    setDefaultProps(tippyProps) {
        tippy.setDefaultProps(tippyProps);
    }
    /**
     * Show all tippies
     */
    showAll() {
        this.tippyInstances.forEach((tippyInstance, key) => {
            tippyInstance.show();
            this.emitInstancesChange('show', key);
        });
    }
    /**
     * Hide all tippies or hide all except a particular one
     * Additional hide them with duration
     *
     * @param { NgxHideAllOptions } [options] - additional hiding options
     */
    hideAll(options) {
        const exclude = options && this.tippyInstances.has(options.excludeName) && this.tippyInstances.get(options.excludeName);
        const duration = options && options.duration;
        hideAll({ duration, exclude });
    }
    /**
     * Subscription to change of tippy instances
     *
     * @returns { Observable<InstancesChanges> } observable of tippy instances change
     */
    get instancesChanges() {
        return this.tippyInstances$.asObservable();
    }
    /**
     * Service methods
     */
    setTemplateVisible(tippyContent) {
        tippyContent instanceof Element && this.renderer.setStyle(tippyContent, 'display', 'block');
    }
    emitInstancesChange(reason, name) {
        const instance = this.tippyInstances.get(name);
        this.tippyInstances$.next({ name, reason, instance });
    }
    createRenderer(rendererFactory) {
        this.renderer = rendererFactory.createRenderer(null, null);
    }
    throwError(message, errorConstrictor = Error) {
        if (!isDevMode())
            return;
        throw new errorConstrictor(message);
    }
}
NgxTippyService.ɵfac = function NgxTippyService_Factory(t) { return new (t || NgxTippyService)(ɵngcc0.ɵɵinject(ɵngcc0.RendererFactory2)); };
NgxTippyService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgxTippyService_Factory() { return new NgxTippyService(i0.ɵɵinject(i0.RendererFactory2)); }, token: NgxTippyService, providedIn: "root" });
NgxTippyService.ctorParameters = () => [
    { type: RendererFactory2 }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(NgxTippyService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc0.RendererFactory2 }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXRpcHB5LnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb2plY3RzL25neC10aXBweS13cmFwcGVyL3NyYy9saWIvbmd4LXRpcHB5LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBYSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEtBQUssRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMxQzs7QUFZQSxNQUFNLE9BQU8sZUFBZTtBQUM1QixJQUlFLFlBQVksZUFBaUM7QUFDL0MsUUFMVSxtQkFBYyxHQUFrQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ3BFLFFBQVUsb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBb0IsQ0FBQztBQUM1RCxRQUdJLElBQUksQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDekMsSUFBRSxDQUFDO0FBQ0gsSUFDRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQ0U7QUFDRjtBQUNFO0FBQ0U7QUFDRTtBQUVKLE9BREc7QUFDTCxJQUFFLFdBQVcsQ0FBQyxJQUFZLEVBQUUsS0FBdUI7QUFDbkQsUUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDekMsUUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ2xELElBQUUsQ0FBQztBQUNILElBQ0U7QUFDRjtBQUNFO0FBQ0U7QUFDRTtBQUVKLE9BREc7QUFDTCxJQUFFLFdBQVcsQ0FBQyxJQUFZO0FBQUksUUFDMUIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENB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LEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO0FBQzFELElBQUUsQ0FBQztBQUNILElBQ1UsY0FBYyxDQUFDLGVBQWlDO0FBQzFELFFBQUksSUFBSSxDQUFDLFFBQVEsR0FBRyxlQUFlLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMvRCxJQUFFLENBQUM7QUFDSCxJQUNVLFVBQVUsQ0FBQyxPQUFlLEVBQUUsbUJBQXFDLEtBQUs7QUFDaEYsUUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO0FBQUUsWUFBQSxPQUFPO0FBQzdCLFFBQUksTUFBTSxJQUFJLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3hDLElBQUUsQ0FBQztBQUNIOzRJQUFDO0FBQ0QsNk1BbFJLO0FBQUM7RUFITCxVQUFVLFNBQUMsckJBSUksWUFoQmdCLGdCQUFnQjtBQUFHO0tBYWpELFVBQVUsRUFBRSxNQUFNLGVBQ25COzs7OztpRkFkb0Q7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIFJlbmRlcmVyMiwgUmVuZGVyZXJGYWN0b3J5MiwgaXNEZXZNb2RlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgdGlwcHksIHsgaGlkZUFsbCB9IGZyb20gJ3RpcHB5LmpzJztcbmltcG9ydCB7XG4gIE5neFRpcHB5SW5zdGFuY2UsXG4gIE5neFRpcHB5UHJvcHMsXG4gIE5neFRpcHB5Q29udGVudCxcbiAgTmd4SGlkZUFsbE9wdGlvbnMsXG4gIEluc3RhbmNlc0NoYW5nZXMsXG4gIEluc3RhbmNlQ2hhbmdlUmVhc29uLFxufSBmcm9tICcuL25neC10aXBweS5pbnRlcmZhY2VzJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIE5neFRpcHB5U2VydmljZSB7XG4gIHByaXZhdGUgdGlwcHlJbnN0YW5jZXM6IE1hcDxzdHJpbmcsIE5neFRpcHB5SW5zdGFuY2U+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHRpcHB5SW5zdGFuY2VzJCA9IG5ldyBTdWJqZWN0PEluc3RhbmNlc0NoYW5nZXM+KCk7XG4gIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMjtcblxuICBjb25zdHJ1Y3RvcihyZW5kZXJlckZhY3Rvcnk6IFJlbmRlcmVyRmFjdG9yeTIpIHtcbiAgICB0aGlzLmNyZWF0ZVJlbmRlcmVyKHJlbmRlcmVyRmFjdG9yeSk7XG4gIH1cblxuICAvKipcbiAgICogV29ya2luZyB3aXRoIHN0b3JhZ2VcbiAgICovXG5cbiAgLyoqXG4gICAqIFdyaXRlIHRpcHB5IGluc3RhbmNlcyB0byBzdG9yYWdlXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKiBAcGFyYW0gc3RhdGUgeyBOZ3hUaXBweUluc3RhbmNlIH0gdGlwcHkgaW5zdGFuY2VcbiAgICovXG4gIHNldEluc3RhbmNlKG5hbWU6IHN0cmluZywgc3RhdGU6IE5neFRpcHB5SW5zdGFuY2UpIHtcbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLnNldChuYW1lLCBzdGF0ZSk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzZXRJbnN0YW5jZScsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzcGVjaWZpYyB0aXBweSBpbnN0YW5jZVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICogQHJldHVybnMgeyBOZ3hUaXBweUluc3RhbmNlIHwgbnVsbCB9IHNwZWNpZmljIHRpcHB5IGluc3RhbmNlIG9yIG51bGxcbiAgICovXG4gIGdldEluc3RhbmNlKG5hbWU6IHN0cmluZyk6IE5neFRpcHB5SW5zdGFuY2UgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkgPyB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKSA6IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCB0aXBweSBpbnN0YW5jZXMgZnJvbSBzdG9yYWdlXG4gICAqXG4gICAqIEByZXR1cm5zIHsgTWFwPHN0cmluZywgTmd4VGlwcHlJbnN0YW5jZT4gfCBudWxsIH0gYWxsIHRpcHB5IGluc3RhbmNlcyBvciBudWxsXG4gICAqL1xuICBnZXRJbnN0YW5jZXMoKTogTWFwPHN0cmluZywgTmd4VGlwcHlJbnN0YW5jZT4gfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy50aXBweUluc3RhbmNlcy5zaXplID8gdGhpcy50aXBweUluc3RhbmNlcyA6IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogV29ya2luZyB3aXRoIHRpcHB5IGluc3RhbmNlIG1ldGhvZHNcbiAgICovXG5cbiAgLyoqXG4gICAqIFByb2dyYW1tYXRpY2FsbHkgc2hvdyB0aGUgdGlwcHlcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBzaG93KG5hbWU6IHN0cmluZykge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLnNob3coKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ3Nob3cnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9ncmFtbWF0aWNhbGx5IGhpZGUgdGhlIHRpcHB5XG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKi9cbiAgaGlkZShuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5oaWRlKCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdoaWRlJywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogV2lsbCBoaWRlIHRoZSB0aXBweSBvbmx5IGlmIHRoZSBjdXJzb3IgaXMgb3V0c2lkZSBvZiB0aGUgdGlwcHkncyBpbnRlcmFjdGl2ZSByZWdpb25cbiAgICogVGhpcyBhbGxvd3MgeW91IHRvIHByb2dyYW1tYXRpY2FsbHkgaG9vayBpbnRvIGludGVyYWN0aXZlIGJlaGF2aW9yIHVwb24gYSBtb3VzZWxlYXZlIGV2ZW50IGlmIGltcGxlbWVudGluZyBjdXN0b20gZXZlbnQgbGlzdGVuZXJzXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIHsgc3RyaW5nIH0gbmFtZSBvZiB0aXBweSBpbnN0YW5jZVxuICAgKiBAcGFyYW0gbmFtZSB7IG1vdXNlRXZlbnQgfSBwYXNzIHRoZSBtb3VzZSBldmVudCBvYmplY3QgaW4gZnJvbSB5b3VyIGV2ZW50IGxpc3RlbmVyXG4gICAqL1xuICBoaWRlV2l0aEludGVyYWN0aXZpdHkobmFtZTogc3RyaW5nLCBtb3VzZUV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuaGlkZVdpdGhJbnRlcmFjdGl2aXR5KG1vdXNlRXZlbnQpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnaGlkZVdpdGhJbnRlcmFjdGl2aXR5JywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogUHJldmVudCBhIHRpcHB5IGZyb20gc2hvd2luZyBvciBoaWRpbmdcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICBkaXNhYmxlKG5hbWU6IHN0cmluZykge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLmRpc2FibGUoKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ2Rpc2FibGUnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZS1lbmFibGUgYSB0aXBweVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICovXG4gIGVuYWJsZShuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5lbmFibGUoKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ2VuYWJsZScsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbnkgdGlwcHkgcHJvcHNcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqIEBwYXJhbSB0aXBweVByb3BzIHsgTmd4VGlwcHlQcm9wcyB9IG5ldyBwcm9wc1xuICAgKi9cbiAgc2V0UHJvcHMobmFtZTogc3RyaW5nLCB0aXBweVByb3BzOiBOZ3hUaXBweVByb3BzKSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuc2V0UHJvcHModGlwcHlQcm9wcyk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzZXRQcm9wcycsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY29udGVudCBmb3IgdGlwcHlcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqIEBwYXJhbSB0aXBweUNvbnRlbnQgeyBOZ3hUaXBweUNvbnRlbnQgfSBuZXcgY29udGVudFxuICAgKi9cbiAgc2V0Q29udGVudChuYW1lOiBzdHJpbmcsIHRpcHB5Q29udGVudDogTmd4VGlwcHlDb250ZW50KSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXRUZW1wbGF0ZVZpc2libGUodGlwcHlDb250ZW50KTtcbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5zZXRDb250ZW50KHRpcHB5Q29udGVudCk7XG4gICAgdGhpcy5lbWl0SW5zdGFuY2VzQ2hhbmdlKCdzZXRDb250ZW50JywgbmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGVsZW1lbnQocykgdGhhdCB0aGUgdHJpZ2dlciBldmVudCBsaXN0ZW5lcnMgYXJlIGFkZGVkIHRvXG4gICAqIEFsbG93cyB5b3UgdG8gc2VwYXJhdGUgdGhlIHRpcHB5J3MgcG9zaXRpb25pbmcgZnJvbSBpdHMgdHJpZ2dlciBzb3VyY2VcbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqIEBwYXJhbSB0cmlnZ2VyVGFyZ2V0IHsgRWxlbWVudCB8IEVsZW1lbnRbXSB9IGVsZW1lbnQocykgdGhhdCB0aGUgdHJpZ2dlciB0b29sdGlwXG4gICAqL1xuICBzZXRUcmlnZ2VyVGFyZ2V0KG5hbWU6IHN0cmluZywgdHJpZ2dlclRhcmdldDogRWxlbWVudCB8IEVsZW1lbnRbXSkge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLnNldFByb3BzKHsgdHJpZ2dlclRhcmdldCB9KTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ3NldFRyaWdnZXJUYXJnZXQnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbm1vdW50IHRoZSB0aXBweSBmcm9tIHRoZSBET01cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgeyBzdHJpbmcgfSBuYW1lIG9mIHRpcHB5IGluc3RhbmNlXG4gICAqL1xuICB1bm1vdW50KG5hbWU6IHN0cmluZykge1xuICAgIGlmICghdGhpcy50aXBweUluc3RhbmNlcy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMudGhyb3dFcnJvcihgSW5zdGFuY2Ugd2l0aCBpZGVudGlmaWVyICcke25hbWV9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG5hbWUpLnVubW91bnQoKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ3VubW91bnQnLCBuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgdGhlIGluc3RhbmNlcyBkZWxheSB0aW1lb3V0c1xuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICovXG4gIGNsZWFyRGVsYXlUaW1lb3V0cyhuYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIXRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aGlzLnRocm93RXJyb3IoYEluc3RhbmNlIHdpdGggaWRlbnRpZmllciAnJHtuYW1lfScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKS5jbGVhckRlbGF5VGltZW91dHMoKTtcbiAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ2NsZWFyRGVsYXlUaW1lb3V0cycsIG5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcm1hbmVudGx5IGRlc3Ryb3kgYW5kIGNsZWFuIHVwIHRoZSB0aXBweSBpbnN0YW5jZVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZSB7IHN0cmluZyB9IG5hbWUgb2YgdGlwcHkgaW5zdGFuY2VcbiAgICovXG4gIGRlc3Ryb3kobmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnRpcHB5SW5zdGFuY2VzLmhhcyhuYW1lKSkge1xuICAgICAgdGhpcy50aHJvd0Vycm9yKGBJbnN0YW5jZSB3aXRoIGlkZW50aWZpZXIgJyR7bmFtZX0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuXG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5nZXQobmFtZSkuZGVzdHJveSgpO1xuICAgIHRoaXMuZW1pdEluc3RhbmNlc0NoYW5nZSgnZGVzdHJveScsIG5hbWUpO1xuICAgIHRoaXMudGlwcHlJbnN0YW5jZXMuZGVsZXRlKG5hbWUpO1xuICB9XG5cbiAgLyoqIFdvcmtpbmcgd2l0aCB0aXBweSBzdGF0aWMgbWV0aG9kcyAqL1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGRlZmF1bHQgcHJvcHMgZm9yIGVhY2ggbmV3IHRpcHB5IGluc3RhbmNlXG4gICAqXG4gICAqIEBwYXJhbSB0aXBweVByb3BzIHsgTmd4VGlwcHlQcm9wcyB9IGRlZmF1bHQgcHJvcHNcbiAgICovXG4gIHNldERlZmF1bHRQcm9wcyh0aXBweVByb3BzOiBOZ3hUaXBweVByb3BzKSB7XG4gICAgdGlwcHkuc2V0RGVmYXVsdFByb3BzKHRpcHB5UHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgYWxsIHRpcHBpZXNcbiAgICovXG4gIHNob3dBbGwoKSB7XG4gICAgdGhpcy50aXBweUluc3RhbmNlcy5mb3JFYWNoKCh0aXBweUluc3RhbmNlOiBOZ3hUaXBweUluc3RhbmNlLCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgdGlwcHlJbnN0YW5jZS5zaG93KCk7XG4gICAgICB0aGlzLmVtaXRJbnN0YW5jZXNDaGFuZ2UoJ3Nob3cnLCBrZXkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgYWxsIHRpcHBpZXMgb3IgaGlkZSBhbGwgZXhjZXB0IGEgcGFydGljdWxhciBvbmVcbiAgICogQWRkaXRpb25hbCBoaWRlIHRoZW0gd2l0aCBkdXJhdGlvblxuICAgKlxuICAgKiBAcGFyYW0geyBOZ3hIaWRlQWxsT3B0aW9ucyB9IFtvcHRpb25zXSAtIGFkZGl0aW9uYWwgaGlkaW5nIG9wdGlvbnNcbiAgICovXG4gIGhpZGVBbGwob3B0aW9ucz86IE5neEhpZGVBbGxPcHRpb25zKSB7XG4gICAgY29uc3QgZXhjbHVkZSA9XG4gICAgICBvcHRpb25zICYmIHRoaXMudGlwcHlJbnN0YW5jZXMuaGFzKG9wdGlvbnMuZXhjbHVkZU5hbWUpICYmIHRoaXMudGlwcHlJbnN0YW5jZXMuZ2V0KG9wdGlvbnMuZXhjbHVkZU5hbWUpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gb3B0aW9ucyAmJiBvcHRpb25zLmR1cmF0aW9uO1xuXG4gICAgaGlkZUFsbCh7IGR1cmF0aW9uLCBleGNsdWRlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN1YnNjcmlwdGlvbiB0byBjaGFuZ2Ugb2YgdGlwcHkgaW5zdGFuY2VzXG4gICAqXG4gICAqIEByZXR1cm5zIHsgT2JzZXJ2YWJsZTxJbnN0YW5jZXNDaGFuZ2VzPiB9IG9ic2VydmFibGUgb2YgdGlwcHkgaW5zdGFuY2VzIGNoYW5nZVxuICAgKi9cbiAgZ2V0IGluc3RhbmNlc0NoYW5nZXMoKTogT2JzZXJ2YWJsZTxJbnN0YW5jZXNDaGFuZ2VzPiB7XG4gICAgcmV0dXJuIHRoaXMudGlwcHlJbnN0YW5jZXMkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcnZpY2UgbWV0aG9kc1xuICAgKi9cbiAgcHVibGljIHNldFRlbXBsYXRlVmlzaWJsZSh0aXBweUNvbnRlbnQ6IE5neFRpcHB5Q29udGVudCkge1xuICAgIHRpcHB5Q29udGVudCBpbnN0YW5jZW9mIEVsZW1lbnQgJiYgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aXBweUNvbnRlbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRJbnN0YW5jZXNDaGFuZ2UocmVhc29uOiBJbnN0YW5jZUNoYW5nZVJlYXNvbiwgbmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLnRpcHB5SW5zdGFuY2VzLmdldChuYW1lKTtcbiAgICB0aGlzLnRpcHB5SW5zdGFuY2VzJC5uZXh0KHsgbmFtZSwgcmVhc29uLCBpbnN0YW5jZSB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUmVuZGVyZXIocmVuZGVyZXJGYWN0b3J5OiBSZW5kZXJlckZhY3RvcnkyKSB7XG4gICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyRmFjdG9yeS5jcmVhdGVSZW5kZXJlcihudWxsLCBudWxsKTtcbiAgfVxuXG4gIHByaXZhdGUgdGhyb3dFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGVycm9yQ29uc3RyaWN0b3I6IEVycm9yQ29uc3RydWN0b3IgPSBFcnJvcikge1xuICAgIGlmICghaXNEZXZNb2RlKCkpIHJldHVybjtcbiAgICB0aHJvdyBuZXcgZXJyb3JDb25zdHJpY3RvcihtZXNzYWdlKTtcbiAgfVxufVxuIl19